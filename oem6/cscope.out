cscope 15 D:\cygwin\home\zhangzheng\mycgi\oem6"               0000018125
	@deco.c

1 
	~<°dio.h
>

2 
	~<uni°d.h
>

3 
	~<°rög.h
>

4 
	~<deco.h
>

5 
	~<m©h.h
>

6 
	~<sys/time.h
>

7 
	~"loggî.h
"

10 
	#OEM4SYNC1
 0xAA

	)

11 
	#OEM4SYNC2
 0x44

	)

12 
	#OEM4SYNC3
 0x12

	)

14 
	#POLYCRC32
 0xEDB88320u

	)

17 
	#U1
(
p
Ë(*((*)’)))

	)

18 
	#I1
(
p
Ë(*((*)’)))

	)

19 
	$U2
(*
p
Ë{
u
; 
	`mem˝y
(&u,p,2);  u;
	}
}

20 
	$U4
(*
p
Ë{
u
; 
	`mem˝y
(&u,p,4);  u;
	}
}

21 
	$I4
(*
p
Ë{
i
; 
	`mem˝y
(&i,p,4);  i;
	}
}

22 
	$R4
(*
p
Ë{
r
; 
	`mem˝y
(&r,p,4); Ñ;
	}
}

23 
	$R8
(*
p
Ë{
r
; 
	`mem˝y
(&r,p,8); Ñ;
	}
}

25 c⁄° 
	gÀ≠s
[][7]={

45 c⁄° 
	ggp°0
[]={1980,1, 6,0,0,0};

47 
	$timediff
(
gtime_t
 
t1
, gtime_à
t2
)

49  
	`dif·ime
(
t1
.
time
,
t2
.time)+t1.
£c
-t2.sec;

50 
	}
}

52 
gtime_t
 
	$timódd
(
gtime_t
 
t
, 
£c
)

54 
â
;

56 
t
.
£c
+=£c; 
â
=
	`Êo‹
—.£c);Å.
time
+=()tt;Å.sec-=tt;

57  
t
;

58 
	}
}

60 
	$e˚f2pos
(c⁄° *
r
, *
pos
)

62 
e2
=
FE_WGS84
*(2.0-FE_WGS84),
r2
=
	`dŸ
(
r
,r,2),
z
,
zk
,
v
=
RE_WGS84
,
söp
;

64 
z
=
r
[2],
zk
=0.0;
	`Ábs
(z-zk)>=1E-4;) {

65 
zk
=
z
;

66 
söp
=
z
/
	`sqπ
(
r2
+z*z);

67 
v
=
RE_WGS84
/
	`sqπ
(1.0-
e2
*
söp
*sinp);

68 
z
=
r
[2]+
v
*
e2
*
söp
;

70 
pos
[0]=
r2
>1E-12?
	`©™
(
z
/
	`sqπ
‘2)):(
r
[2]>0.0?
PI
/2.0:-PI/2.0);

71 
pos
[1]=
r2
>1E-12?
	`©™2
(
r
[1],r[0]):0.0;

72 
pos
[2]=
	`sqπ
(
r2
+
z
*z)-
v
;

73 
	}
}

75 
gtime_t
 
	$ïoch2time
(c⁄° *
ï
)

77 c⁄° 
doy
[]={1,32,60,91,121,152,182,213,244,274,305,335};

78 
gtime_t
 
time
={0};

79 
days
,
£c
,
yór
=()
ï
[0],
m⁄
=(Îp[1],
day
=()ep[2];

81 i‡(
yór
<1970||2099<yór||
m⁄
<1||12<m⁄Ë 
time
;

84 
days
=(
yór
-1970)*365+(yór-1969)/4+
doy
[
m⁄
-1]+
day
-2+(year%4==0&&mon>=3?1:0);

85 
£c
=()
	`Êo‹
(
ï
[5]);

86 
time
.time=(
time_t
)
days
*86400+()
ï
[3]*3600+(Îp[4]*60+
£c
;

87 
time
.
£c
=
ï
[5]-sec;

88  
time
;

89 
	}
}

91 
gtime_t
 
	$gp°2utc
(
gtime_t
 
t
)

93 
gtime_t
 
tu
;

94 
i
;

96 
i
=0;i<()(
À≠s
)/()(*leaps);i++) {

97 
tu
=
	`timódd
(
t
,
À≠s
[
i
][6]);

98 i‡(
	`timediff
(
tu
,
	`ïoch2time
(
À≠s
[
i
]))>=0.0) Åu;

100  
t
;

101 
	}
}

103 
	$deg2dms
(
deg
, *
dms
)

105 
sign
=
deg
<0.0?-1.0:1.0,
a
=
	`Ábs
(deg);

106 
dms
[0]=
	`Êo‹
(
a
);á=(a-dms[0])*60.0;

107 
dms
[1]=
	`Êo‹
(
a
);á=(a-dms[1])*60.0;

108 
dms
[2]=
a
; dms[0]*=
sign
;

109 
	}
}

111 
	$time2ïoch
(
gtime_t
 
t
, *
ï
)

113 c⁄° 
mday
[]={

117 
days
,
£c
,
m⁄
,
day
;

120 
days
=()(
t
.
time
/86400);

121 
£c
=()(
t
.
time
-(
time_t
)
days
*86400);

122 
day
=
days
%1461,
m⁄
=0;mon<48;mon++) {

123 i‡(
day
>=
mday
[
m⁄
]) day-=mday[mon]; ;

125 
ï
[0]=1970+
days
/1461*4+
m⁄
/12;Ép[1]=m⁄%12+1;Ép[2]=
day
+1;

126 
ï
[3]=
£c
/3600;Ép[4]=£c%3600/60;Ép[5]=£c%60+
t
.sec;

127 
	}
}

129 
	$time2°r
(
gtime_t
 
t
, *
s
, 
n
)

131 
ï
[6];

133 i‡(
n
<0)Ç=0; if (n>12)Ç=12;

134 i‡(1.0-
t
.
£c
<0.5/
	`pow
(10.0,
n
)Ë{t.
time
++;Å.sec=0.0;};

135 
	`time2ïoch
(
t
,
ï
);

136 
	`•rötf
(
s
,"%04.0f/%02.0f/%02.0‡%02.0f:%02.0f:%0*.*f",
ï
[0],ep[1],ep[2],

137 
ï
[3],ï[4],
n
<=0?2:n+3,n<=0?0:n,ep[5]);

138 
	}
}

140 *
	$time_°r
(
gtime_t
 
t
, 
n
)

142 
buff
[64];

143 
	`time2°r
(
t
,
buff
,
n
);

144  
buff
;

145 
	}
}

147 
	$exsign
(
v
, 
bôs
)

149  ()(
v
&(1<<(
bôs
-1))?v|(~0u<<bits):v);

150 
	}
}

153 
timeoff£t_
=0.0;

155 
gtime_t
 
	$timegë
()

157 
ï
[6]={0};

158 #ifde‡
WIN32


159 
SYSTEMTIME
 
ts
;

161 
	`GëSy°emTime
(&
ts
);

162 
ï
[0]=
ts
.
wYór
;Ép[1]Òs.
wM⁄th
;Ép[2]Òs.
wDay
;

163 
ï
[3]=
ts
.
wHour
;Ép[4]Òs.
wMöuã
;Ép[5]Òs.
wSec⁄d
+ts.
wMûli£c⁄ds
*1E-3;

165 
timevÆ
 
tv
;

166 
tm
 *
â
;

168 i‡(!
	`gëtimeofday
(&
tv
,
NULL
)&&(
â
=
	`gmtime
(&tv.
tv_£c
))) {

169 
ï
[0]=
â
->
tm_yór
+1900;Ép[1]Òt->
tm_m⁄
+1;Ép[2]Òt->
tm_mday
;

170 
ï
[3]=
â
->
tm_hour
;Ép[4]Òt->
tm_mö
;Ép[5]Òt->
tm_£c
+
tv
.
tv_u£c
*1E-6;

173  
	`timódd
(
	`ïoch2time
(
ï
),
timeoff£t_
);

174 
	}
}

177 
gtime_t
 
	$utc2gp°
(
gtime_t
 
t
)

179 
i
;

181 
i
=0;i<()(
À≠s
)/()(*leaps);i++) {

182 i‡(
	`timediff
(
t
,
	`ïoch2time
(
À≠s
[
i
]))>=0.0Ë 
	`timódd
(t,-leaps[i][6]);

184  
t
;

185 
	}
}

187 
	$time2gp°
(
gtime_t
 
t
, *
wìk
)

189 
gtime_t
 
t0
=
	`ïoch2time
(
gp°0
);

190 
time_t
 
£c
=
t
.
time
-
t0
.time;

191 
w
=()(
£c
/(86400*7));

193 i‡(
wìk
Ë*wìk=
w
;

194  ()(
£c
-
w
*86400*7)+
t
.sec;

195 
	}
}

198 
gtime_t
 
	$gp°2time
(
wìk
, 
£c
)

200 
gtime_t
 
t
=
	`ïoch2time
(
gp°0
);

202 i‡(
£c
<-1E9||1E9<sec) sec=0.0;

203 
t
.
time
+=86400*7*
wìk
+()
£c
;

204 
t
.
£c
=sec-()sec;

205  
t
;

206 
	}
}

208 
	$adjgpswìk
(
wìk
)

210 
w
;

211 ()
	`time2gp°
(
	`utc2gp°
(
	`timegë
()),&
w
);

212 i‡(
w
<1560) w=1560;

213  
wìk
+(
w
-week+512)/1024*1024;

214 
	}
}

216 
	$¸c32
(c⁄° *
buff
, 
Àn
)

218 
¸c
=0;

219 
i
,
j
;

222 
i
=0;i<
Àn
;i++) {

223 
¸c
^=
buff
[
i
];

224 
j
=0;j<8;j++) {

225 i‡(
¸c
&1Ë¸c=(¸c>>1)^
POLYCRC32
; crc>>=1;

228  
¸c
;

229 
	}
}

231 
	$sync_€m4
(*
buff
, 
d©a
)

233 
buff
[0]=buff[1]; buff[1]=buff[2]; buff[2]=
d©a
;

234  
buff
[0]==
OEM4SYNC1
&&buff[1]==
OEM4SYNC2
&&buff[2]==
OEM4SYNC3
;

235 
	}
}

237 
	$decode_h˙bﬂrd
(
h˙øw_t
 *
h˙øw
){

239 *
p
 = 
h˙øw
->
buff
;

240 
i
;

242 if(
h˙øw
->
Àn
 < 71){

243 
	`¥ötf
("boardÜen < 71\n");

246 
h˙øw
->
bﬂrd
.
a˝ulﬂd
 = 
	`U1
(
p
+28);

247 
h˙øw
->
bﬂrd
.
d˝ulﬂd
 = 
	`U1
(
p
+29);

248 
h˙øw
->
bﬂrd
.
a°©us
 = 
	`U1
(
p
+30);

249 
h˙øw
->
bﬂrd
.
d°©us
 = 
	`U1
(
p
+31);

250 
h˙øw
->
bﬂrd
.
f°©us
 = 
	`U1
(
p
+32);

251 
h˙øw
->
bﬂrd
.
w‹k°©us
 = 
	`U1
(
p
+33);

252 
h˙øw
->
bﬂrd
.
maö™äw‹k°a

	`U1
(
p
+34);

253 
h˙øw
->
bﬂrd
.
maö™ärf°a
 = 
	`U1
(
p
+35);

254 
h˙øw
->
bﬂrd
.
Ø¡nw‹k°a
 = 
	`U1
(
p
+36);

255 
h˙øw
->
bﬂrd
.
Ø¡ƒf°a
 = 
	`U1
(
p
+37);

256 
h˙øw
->
bﬂrd
.
Ê¨ód
 = 
	`U1
(
p
+38);

257 
h˙øw
->
bﬂrd
.
Êawrôe
 = 
	`U1
(
p
+39);

260 
i
 = 0;i < 4;i++)

261 
h˙øw
->
bﬂrd
.
ù
[
i
] = 
	`U1
(
p
+48+i);

262 
i
 = 0;i < 4;i++)

263 
h˙øw
->
bﬂrd
.
√tmask
[
i
] = 
	`U1
(
p
+52+i);

264 
i
 = 0;i < 4;i++)

265 
h˙øw
->
bﬂrd
.
g©eway
[
i
] = 
	`U1
(
p
+56+i);

266 
i
 = 0;i < 4;i++)

267 
h˙øw
->
bﬂrd
.
dns
[
i
] = 
	`U1
(
p
+60+i);

268 
h˙øw
->
bﬂrd
.
sockty≥
 = 
	`U1
(
p
+64);

269 
h˙øw
->
bﬂrd
.
p‹t

	`U2
(
p
+65);

270 
i
 = 0;i < 4;i++)

271 
h˙øw
->
bﬂrd
.
£rvîù
[
i
] = 
	`U1
(
p
+67+i);

274 
	`¥ötf
("ù:%d %d %d %d\n",
h˙øw
->
bﬂrd
.
ù
[0],hcnraw->board.ip[1],

275 
h˙øw
->
bﬂrd
.
ù
[2],hcnraw->board.ip[3]);

276 
	`¥ötf
("√tmsk:%d %d %d %d\n",
h˙øw
->
bﬂrd
.
√tmask
[0],hcnraw->board.netmask[1],

277 
h˙øw
->
bﬂrd
.
√tmask
[2],hcnraw->board.netmask[3]);

278 
	`¥ötf
("g©eway:%d %d %d %d\n",
h˙øw
->
bﬂrd
.
g©eway
[0],hcnraw->board.gateway[1],

279 
h˙øw
->
bﬂrd
.
g©eway
[2],hcnraw->board.gateway[3]);

280 
	`¥ötf
("dns:%d %d %d %d\n",
h˙øw
->
bﬂrd
.
dns
[0],hcnraw->board.dns[1],

281 
h˙øw
->
bﬂrd
.
dns
[2],hcnraw->board.dns[3]);

282 
	`¥ötf
("sockty≥:%dÖ‹t:%d\n",
h˙øw
->
bﬂrd
.
sockty≥
,h˙øw->bﬂrd.
p‹t
);

283 
	`¥ötf
("£rvîù:%d %d %d %d\n",
h˙øw
->
bﬂrd
.
£rvîù
[0],hcnraw->board.serverip[1],

284 
h˙øw
->
bﬂrd
.
£rvîù
[2],hcnraw->board.serverip[3]);

288 
	`¥ötf
("board:\n");

289 
	`¥ötf
("%d %d %d %d %d %d %d %d %d %d %d %d \n",
h˙øw
->
bﬂrd
.
a˝ulﬂd
,

290 
h˙øw
->
bﬂrd
.
d˝ulﬂd
,h˙øw->bﬂrd.
a°©us
,h˙øw->bﬂrd.
d°©us
,

291 
h˙øw
->
bﬂrd
.
f°©us
,h˙øw->bﬂrd.
w‹k°©us
,h˙øw->bﬂrd.
m™äw‹k°a
,

292 
h˙øw
->
bﬂrd
.
m™ärf°a
,h˙øw->bﬂrd.
Ø¡nw‹k°a
,h˙øw->bﬂrd.
Ø¡ƒf°a
,

293 
h˙øw
->
bﬂrd
.
Ê¨ód
,h˙øw->bﬂrd.
Êawrôe


297 
	}
}

299 
	$decode_h˙pùe
(
h˙øw_t
 *
h˙øw
){

301 *
p
 = 
h˙øw
->
buff
;

302 
i
;

304 
h˙øw
->
pùes
.
ch™num
 = 
	`U2
(
p
+28);

306 if(
h˙øw
->
Àn
 < h˙øw->
pùes
.
ch™num
*37+2)  -1;

308 
i
 = 0;ò< 
h˙øw
->
pùes
.
ch™num
;i++){

309 
h˙øw
->
pùes
.
pùe
[
i
].
ch™id
 = 
	`U2
(
p
+30+i*37);

310 
h˙øw
->
pùes
.
pùe
[
i
].
ßãid
 = 
	`U1
(
p
+32+i*37);

311 
h˙øw
->
pùes
.
pùe
[
i
].
tick
 = 
	`U4
(
p
+33+i*37);

312 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
‰íu
 = 
	`U1
(
p
+37+i*37)&0x3F;

313 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
codëy≥
 = (
	`U1
(
p
+37+i*37)>>6)&0x3;

314 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
obs°©e
 = 
	`U1
(
p
+38+i*37)&0x7;

315 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
sig°©e
(
	`U1
(
p
+38+i*37)>>3)&0x1F;

316 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
ñe°©e
(
	`U1
(
p
+39+i*37))&0x3F;

317 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
…ag
(
	`U1
(
p
+39+i*37)>>6)&0x1;

318 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
±ag
(
	`U1
(
p
+39+i*37)>>7)&0x1;

319 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
glo‰eq
(
	`U1
(
p
+40+i*37))&0xFF;

320 
h˙øw
->
pùes
.
pùe
[
i
].
pùeobs
.
D

	`exsign
(
	`U4
(
p
+41+i*37)&0xFFFFFFF,28)/256.0;

321 
h˙øw
->
pùes
.
pùe
[
i
].
pùeobs
.
P
(
	`U4
(
p
+44+i*37)>>4)/128.0+
	`U1
(p+48+i*36)*2097152.0;

322 
h˙øw
->
pùes
.
pùe
[
i
].
pùeobs
.
L
(
	`I4
(
p
+49+i*37))/2000.0+h˙øw->pùes.pùe[i].pùeobs.
P
;

323 
h˙øw
->
pùes
.
pùe
[
i
].
pùeobs
.
p°d
 = ((
	`U1
(
p
+53+i*37))&0xF)/128.0;

324 
h˙øw
->
pùes
.
pùe
[
i
].
pùeobs
.
l°d
 = (((
	`U1
(
p
+53+i*37))>> 4)&0xF)/256.0;

325 
h˙øw
->
pùes
.
pùe
[
i
].
˙0
 = 
	`U1
(
p
+54+i*37);

326 
h˙øw
->
pùes
.
pùe
[
i
].
locktime
 = 
	`R4
(
p
+55+i*37);

328 
	`¥ötf
("d›:%‡p§:%‡p°d:%‡adr:%‡l°d:%f\n",
d›
,
p§
,
p°d
,
adr
,
l°d
);

333 
i
 = 10;

335 
	`¥ötf
("ch™id:%d s©eid:%dÅick:%d fªnu:%d codëy≥:%d\n",
h˙øw
->
pùes
.
pùe
[
i
].
ch™id
,

336 
h˙øw
->
pùes
.
pùe
[
i
].
ßãid
,h˙øw->pùes.pùe[i].
tick
,h˙øw->pùes.pùe[i].
°aw‹d
.
‰íu
,

337 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
codëy≥
);

340 
	`¥ötf
("obs°©e:%d sig°©e:%dÉÀ°©e:%dÜèg:%dÖèg:%d glo‰eq:%d\n",
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
obs°©e
,

341 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
sig°©e
,h˙øw->pùes.pùe[i].°aw‹d.
ñe°©e
,h˙øw->pùes.pùe[i].°aw‹d.
…ag
,

342 
h˙øw
->
pùes
.
pùe
[
i
].
°aw‹d
.
±ag
,h˙øw->pùes.pùe[i].°aw‹d.
glo‰eq
);

345 
	`¥ötf
("d›:%‡p§:%‡p°d:%‡adr:%‡l°d:%f\n",
d›
,
p§
,
p°d
,
adr
,
l°d
);

348 
	`¥ötf
("˙0:%dÜocktime:%f\n",
h˙øw
->
pùes
.
pùe
[
i
].
˙0
,h˙øw->pùes.pùe[i].
locktime
);

353 
	`¥ötf
("me¶ígth:%d\n",
	`U4
(
p
+28));

354 
	`¥ötf
("ch™num:%d\n",
h˙øw
->
pùes
.
ch™num
);

356  
h˙øw
->
pùes
.
ch™num
*7+1;

357 
	}
}

359 
	$decode_be°pos
(
h˙øw_t
 *
h˙øw
){

361 *
p
 = 
h˙øw
->
buff
+
OEM4HLEN
;

363 if(
h˙øw
->
Àn
 < 
OEM4HLEN
+72)  -1;

364 
h˙øw
->
be°pos
.
po°y≥
 = 
	`U4
(
p
+4);

365 
h˙øw
->
be°pos
.
œt
 = 
	`R8
(
p
+8);

366 
h˙øw
->
be°pos
.
l⁄
 = 
	`R8
(
p
+16);

367 
h˙øw
->
be°pos
.
hgt
 = 
	`R8
(
p
+24);

368 
h˙øw
->
be°pos
.
°nid
 = 
	`U4
(
p
+52);

369 
h˙øw
->
be°pos
.
difÁge
 = 
	`U4
(
p
+56);

371 
	`¥ötf
("%‡ %‡ %‡ %‡ %‡ %f\n",
h˙øw
->
be°pos
.
œt
,h˙øw->be°pos.
l⁄
,h˙øw->be°pos.
hgt
,

372 
h˙øw
->
be°pos
.
°nid
,h˙øw->be°pos.
difÁge
,h˙øw->be°pos.
po°y≥
);

376 
	}
}

378 
	$decode_dúec
(
h˙øw_t
 *
h˙øw
){

380 *
p
 = 
h˙øw
->
buff
;

382 if(
h˙øw
->
Àn
 < 154)  -1;

383 
h˙øw
->
dúec
.
qf
 = 
	`U1
(
p
+28);

384 
h˙øw
->
dúec
.
ßäum
 = 
	`U1
(
p
+29);

385 
h˙øw
->
dúec
.
pôch
 = 
	`R8
(
p
+30);

386 
h˙øw
->
dúec
.
rﬁl

	`R8
(
p
+38);

387 
h˙øw
->
dúec
.
hódög

	`R8
(
p
+46);

388 
h˙øw
->
dúec
.
ba£œt

	`R8
(
p
+54);

389 
h˙øw
->
dúec
.
ba£l⁄

	`R8
(
p
+62);

390 
h˙øw
->
dúec
.
ba£hgt

	`R8
(
p
+70);

391 
h˙øw
->
dúec
.
rovñ©

	`R8
(
p
+78);

392 
h˙øw
->
dúec
.
rovñ⁄

	`R8
(
p
+86);

393 
h˙øw
->
dúec
.
rovehgt

	`R8
(
p
+94);

394 
h˙øw
->
dúec
.
hd›

	`R4
(
p
+102);

397 
	`¥ötf
("direc:\n");

398 
	`¥ötf
("%d %d %‡%‡%‡%‡%‡%‡%‡%‡%‡%f\n",
h˙øw
->
dúec
.
qf
,h˙øw->dúec.
ßäum
,

399 
h˙øw
->
dúec
.
pôch
,h˙øw->dúec.
rﬁl
,h˙øw->dúec.
hódög
,h˙øw->dúec.
ba£œt
,h˙øw->dúec.
ba£l⁄
,

400 
h˙øw
->
dúec
.
ba£hgt
,h˙øw->dúec.
rovñ©
,h˙øw->dúec.
rovñ⁄
,h˙øw->dúec.
rovehgt
,h˙øw->dúec.
hd›
);

403 
	`¥ötf
("œt:%‡Ü⁄:%‡ hgt:%f\n",
h˙øw
->
dúec
.
ba£œt
,h˙øw->dúec.
ba£l⁄
,h˙øw->dúec.
ba£hgt
);

406 
	}
}

408 
	$decode_ßt
(
h˙øw_t
 *
h˙øw
){

410 *
p
 = 
h˙øw
->
buff
;

411 
i
,
j
,
k
;

414 if(
h˙øw
->
Àn
 < 207)  -1;

415 
	`¥ötf
("Àn:%d\n",
h˙øw
->
Àn
);

417 
h˙øw
->
ßçro
.
pvt°©us
 = 
	`U1
(
p
+28);

418 
h˙øw
->
ßçro
.
sﬁ°acode

	`U1
(
p
+29);

419 
h˙øw
->
ßçro
.
vñcode
 = 
	`U1
(
p
+30);

420 
j
 = 
h˙øw
->
ßçro
.
ßäum
 = 
	`U1
(
p
+31);

421 
h˙øw
->
ßçro
.
sﬁßäum
 = 
	`U1
(
p
+32);

422 
h˙øw
->
ßçro
.
age
 = 
	`R4
(
p
+33);

423 
i
 = 0;ò< 4;i++Ë
h˙øw
->
ßçro
.
°nid
[0] = 
	`U1
(
p
+37+i);

424 
h˙øw
->
ßçro
.
unduœti⁄
 = 
	`R4
(
p
+41);

425 
h˙øw
->
ßçro
.
suc˚ss˙t
 = 
	`U4
(
p
+45);

426 
h˙øw
->
ßçro
.
x
 = 
	`R8
(
p
+49);

427 
h˙øw
->
ßçro
.
y
 = 
	`R8
(
p
+57);

428 
h˙øw
->
ßçro
.
z
 = 
	`R8
(
p
+65);

429 
h˙øw
->
ßçro
.
vx
 = 
	`R8
(
p
+73);

430 
h˙øw
->
ßçro
.
vy
 = 
	`R8
(
p
+81);

431 
h˙øw
->
ßçro
.
vz
 = 
	`R8
(
p
+89);

432 
h˙øw
->
ßçro
.
pd›
 = 
	`R4
(
p
+97);

433 
h˙øw
->
ßçro
.
gd›
 = 
	`R4
(
p
+101);

434 
h˙øw
->
ßçro
.
td›
 = 
	`R4
(
p
+105);

435 
h˙øw
->
ßçro
.
vd›
 = 
	`R4
(
p
+109);

436 
h˙øw
->
ßçro
.
hd›
 = 
	`R4
(
p
+113);

437 
h˙øw
->
ßçro
.
ecutoff
 = 
	`R4
(
p
+117);

438 
h˙øw
->
ßçro
.
po§ms
 = 
	`R8
(
p
+121);

439 
h˙øw
->
ßçro
.
vñrms
 = 
	`R8
(
p
+129);

440 
h˙øw
->
ßçro
.
˛kbüs
 = 
	`R8
(
p
+137);

441 
h˙øw
->
ßçro
.
˛kdri·
 = 
	`R8
(
p
+145);

442 
h˙øw
->
ßçro
.
mó¢um
 = 
	`U2
(
p
+153);

443 
k
 = 0;k < 
j
;k++){

444 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
svid
 = 
	`U2
(
p
+155+k*68);

445 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
ßt°©us
 = 
	`U1
(
p
+157+k*68);

446 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
sigty≥
 = 
	`U1
(
p
+158+k*68);

447 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
sﬁ˙t
 = 
	`U4
(
p
+159+k*68);

448 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
ñev©i⁄
 = 
	`R4
(
p
+163+k*68);

449 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
azimuth
 = 
	`R4
(
p
+167+k*68);

450 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
å€º‹
 = 
	`R8
(
p
+171+k*68);

451 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
i⁄îr‹
 = 
	`R8
(
p
+179+k*68);

452 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
po£º‹
 = 
	`R8
(
p
+187+k*68);

453 
i
 = 0;ò< 3;i++Ë
h˙øw
->
ßçro
.
ßçroßt
[
k
].
˙
[i] = 
	`R4
(
p
+i*4+195+k*68);

456 
	`¥ötf
("ßäum:%d\n",
h˙øw
->
ßçro
.
ßäum
);

459 
	`¥ötf
("pvt°©us:%d sﬁ°acode:%d vñcode:%dßäum:%dáge:%‡°nid0:%d säid1:%d säid2:%d säid3:%d\n",
h˙øw
->
ßçro
.
pvt°©us
,
øw
->ßçro.
sﬁ°acode
,øw->ßçro.
vñcode
,

460 
h˙øw
->
ßçro
.
ßäum
,
øw
->ßçro.
age
,øw->ßçro.
°nid
[0],raw->satpro.stnid[1],

461 
h˙øw
->
ßçro
.
°nid
[2],
øw
->satpro.stnid[3]);

464 
	`¥ötf
("solsatnum:%d undulation:%d successcnt:%dÖdop:%f gdop:%fÅdop:%f vdop:%f hdop:%f\n",

465 
h˙øw
->
ßçro
.
sﬁßäum
,
øw
->ßçro.
unduœti⁄
,øw->ßçro.
suc˚ss˙t
,

466 
h˙øw
->
ßçro
.
pd›
,
øw
->ßçro.
gd›
,øw->ßçro.
td›
,øw->ßçro.
vd›
);

469 
	`¥ötf
("vx:%‡vy:%‡vz:%f\n",
h˙øw
->
ßçro
.
vx
,
øw
->ßçro.
vy
,øw->ßçro.
vz
);

472 
	`¥ötf
("x:%‡y:%‡z:%f\n",
h˙øw
->
ßçro
.
x
,
øw
->ßçro.
y
,øw->ßçro.
z
);

475 
	`¥ötf
("ecutoff:%‡po§ms:%‡vñrms:%‡˛kbüs:%‡˛kdri·:%‡mó¢um:%d\n",
h˙øw
->
ßçro
.
ecutoff
,

476 
h˙øw
->
ßçro
.
po§ms
,
øw
->ßçro.
vñrms
,øw->ßçro.
˛kbüs
,øw->ßçro.
˛kdri·
,

477 
h˙øw
->
ßçro
.
mó¢um
);

481 
k
 = 0;k < 
j
;k++){

483 
k
 = 8;

484 
	`¥ötf
("svid:%d satstatus:%d sigtype:%d solcnt:%dÉlevation:%fázimuth:%fÅroerror:%f ionerror:%fÖoserror:%f\n",

485 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
svid
,
øw
->ßçro.ßçroßt[k].
ßt°©us
,øw->ßçro.ßçroßt[k].
sigty≥
,

486 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
sﬁ˙t
,
øw
->ßçro.ßçroßt[k].
ñev©i⁄
,øw->ßçro.ßçroßt[k].
azimuth
,

487 
h˙øw
->
ßçro
.
ßçroßt
[
k
].
å€º‹
,
øw
->ßçro.ßçroßt[k].
i⁄îr‹
,øw->ßçro.ßçroßt[k].
po£º‹
);

493 
	}
}

494 
	$decode_ßtvis
(
h˙øw_t
 *
h˙øw
){

496 *
p
 = 
h˙øw
->
buff
+
OEM4HLEN
;

498 if(
h˙øw
->
Àn
 < 
OEM4HLEN
+44)  -1;

499 
h˙øw
->
ßtvis
.
ñev
 = 
	`R8
(
p
+20);

500 
h˙øw
->
ßtvis
.
az
 = 
	`R8
(
p
+28);

502 
	`¥ötf
("%‡ %f\n",
h˙øw
->
ßtvis
.
ñev
,h˙øw->ßtvis.
az
);

505 
	}
}

507 
	$decode_öãr
(
h˙øw_t
* 
h˙øw
){

509 *
p
 = 
h˙øw
->
buff
;

510 
i
;

512 
h˙øw
->
öãr
.
num
 = 
	`U1
(
p
+28);

513 
i
 = 0;ò< 
h˙øw
->
öãr
.
num
;i++){

514 
h˙øw
->
öãr
.
öãrs
[
i
].
comid
 = 
	`U1
(
p
+29+i*6);

515 
h˙øw
->
öãr
.
öãrs
[
i
].
Êag

	`U1
(
p
+30+i*6);

516 
h˙øw
->
öãr
.
öãrs
[
i
].
msgid

	`U2
(
p
+31+i*6);

517 
h˙øw
->
öãr
.
öãrs
[
i
].
≥riod

	`U2
(
p
+33+i*6);

519 
h˙øw
->
öãr
.
ªty≥
 = 
	`U1
(
p
+29+
i
*6*h˙øw->öãr.
num
);

520 
i
 = 0;i < 3;i++){

521 
h˙øw
->
öãr
.
comty≥
[
i
]
	`U1
(
p
+30+6*h˙øw->öãr.
num
+i);

523 
h˙øw
->
öãr
.
syty≥
 = 
	`U1
(
p
+33+6*h˙øw->öãr.
num
);

524 
h˙øw
->
öãr
.
sidŸy≥

	`U1
(
p
+34+6*h˙øw->öãr.
num
);

525 
h˙øw
->
öãr
.
dúty≥

	`U1
(
p
+35+6*h˙øw->öãr.
num
);

526 
h˙øw
->
öãr
.
dúÀn

	`R8
(
p
+36+6*h˙øw->öãr.
num
);

528 
	}
}

530 
	$decode_h˙€m4
(
h˙øw_t
 *
h˙øw
,*
ty≥
)

532 
tow
;

533 
msg
,
wìk
;

534 *
ty≥
=
	`U2
(
h˙øw
->
buff
+4);

537 i‡(
	`¸c32
(
h˙øw
->
buff
,h˙øw->
Àn
)!=
	`U4
(hcnraw->buff+hcnraw->len)) {

538 
	`loge
("€m4 cr¯îr‹:Åy≥=%3dÜí=%d\n",*
ty≥
,
h˙øw
->
Àn
);

542 
msg
 =(
	`U1
(
h˙øw
->
buff
+6)>>4)&0x3;

543 
wìk
=
	`adjgpswìk
(
	`U2
(
h˙øw
->
buff
+14));

544 
tow
 =
	`U4
(
h˙øw
->
buff
+16)*0.001;

545 
h˙øw
->
time
=
	`gp°2time
(
wìk
,
tow
);

547 i‡(
h˙øw
->
ouây≥
) {

548 
	`•rötf
(
h˙øw
->
msgty≥
,"OEM4 %4d (%4d): msg=%d %s",*
ty≥
,h˙øw->
Àn
,
msg
,

549 
	`time_°r
(
	`gp°2time
(
wìk
,
tow
),2));

551 i‡(
msg
!=0)  0;

553 *
ty≥
) {

554 
ID_HCNBOARD
 :  
	`decode_h˙bﬂrd
 (
h˙øw
);

555 
ID_HCNPIPE
 :  
	`decode_h˙pùe
 (
h˙øw
);

556 
ID_BESTPOS
 :  
	`decode_be°pos
 (
h˙øw
);

557 
ID_SATVIS
 :  
	`decode_ßtvis
 (
h˙øw
);

558 
ID_DIREC
 :  
	`decode_dúec
 (
h˙øw
);

559 
ID_SAT
 :  
	`decode_ßt
 (
h˙øw
);

560 
ID_INTER
 :  
	`decode_öãr
 (
h˙øw
);

563 
	}
}

564 
	$dŸ
(c⁄° *
a
, c⁄° *
b
, 
n
)

566 
c
=0.0;

568 --
n
>=0Ë
c
+=
a
[n]*
b
[n];

569  
c
;

570 
	}
}

572 
	$öput_h˙€m4p
(
h˙øw_t
 *
h˙øw
,
fd
,*
ty≥
)

574 
i
,
ªs
;

575 
d©a
;

577 i‡(
h˙øw
->
nbyã
==0) {

578 
i
=0;;i++) {

579 i‡((
ªs
=
	`ªad
(
fd
,&
d©a
,1)) != 1)  -2;

580 i‡(
	`sync_€m4
(
h˙øw
->
buff
,
d©a
)) ;

581 i‡(
i
>=4096)  0;

584 i‡(
	`ªad
(
fd
,
h˙øw
->
buff
+3,7)<1)  -2;

585 
h˙øw
->
nbyã
=10;

587 i‡((
h˙øw
->
Àn
=
	`U2
(h˙øw->
buff
+8)+
OEM4HLEN
)>
MAXRAWLEN
-4) {

588 
h˙øw
->
nbyã
=0;

591 i‡(
	`ªad
(
fd
,
h˙øw
->
buff
+10,h˙øw->
Àn
-6)<1)  -2;

592 
h˙øw
->
nbyã
=0;

595  
	`decode_h˙€m4
(
h˙øw
,
ty≥
);

596 
	}
}

	@
1
.
0
1
7
deco.c
